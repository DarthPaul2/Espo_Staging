{
    "beforeSaveCustomScript": "# 0) Заголовок позиции из названия материала, если пусто\r\nifThen(\r\n    isEmpty(name) && !isEmpty(materialId),\r\n    setAttribute('name', materialName)\r\n);\r\n\r\n# 1) Подтянуть в редактируемые поля из foreign (реагирует мгновенно в UI)\r\nifThen(\r\n    !isEmpty(materialId) && isEmpty(preis),\r\n    setAttribute('preis', materialPreis)\r\n);\r\nifThen(\r\n    !isEmpty(materialId) && isEmpty(einheit),\r\n    setAttribute('einheit', materialEinheit)\r\n);\r\n\r\n# 2) Безопасные значения\r\n$qty = ifEmpty(menge, 0);\r\n$pr = ifEmpty(preis, 0);\r\n$disc = ifEmpty(rabatt, 0);    # скидка в %\r\n\r\n# 3) Нетто по позиции с учётом скидки\r\n$tmpNetto = $qty * $pr * (1 - ($disc / 100));\r\n\r\n# 4) Ставка по флажкам из шапки (foreign-поля из Angebot)\r\n$vat = 19;\r\nifThen(angebotOption13b, $vat = 0);   # § 13b -> 0%\r\nifThen(angebotOption12, $vat = 0);    # § 12 Abs.3 -> 0%\r\n\r\n# 5) Итоги: сохраняем и нетто, и брутто в поля\r\nsetAttribute('netto', round($tmpNetto, 2));\r\nsetAttribute('gesamt', round($tmpNetto * (1 + $vat / 100), 2));"
}